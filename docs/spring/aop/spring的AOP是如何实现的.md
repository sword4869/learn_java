# spring的aop是如何实现的


Spring AOP的实现方式有两种：**动态代理和字节码操作**。
- 动态代理: **JDK动态代理和CGLIB动态代理**

   如果被代理的目标对象实现了接口，Spring AOP将使用JDK动态代理来创建代理对象；

   如果没有实现接口，将使用CGLIB动态代理来创建代理对象。

- 字节码操作：AspectJ AOP
  
    AspectJ 是一个独立的AOP框架，Spring集成了AspectJ。
    
    通过使用AspectJ注解或XML配置来修改字节码。

# JDK动态代理 和 CGLIB 动态代理的区别

代理对象：

​	JDK动态代理只能代理**实现了接口的类**，

​	CGLIB可以代理**任何普通类**。

实现原理：

​	JDK动态代理使用Java**反射机制**生成代理对象。我们只需要**定义目标接口**和**实现目标接口的目标类**，JDK动态代理会在运行时在内存中动态地创建一个实现目标接口的代理类。

​	CGLIB 则是一个代码生成的类库，CGLIB 是基于**继承**的代理，通过CGLIB库生成目标对象的子类来实现代理。但如果被代理的类为final，则无法使用CGLIB。

方法：

​	JDK 动态代理只能代理目标对象的接口方法。

​	CGLIB 动态代理可以代理目标类及其父类中的方法

性能：

​	由于CGLIB采用的是生成字节码的方式，所以**运行速度比反射快**，但是创建代理对象的速度较慢。

​	所以对于**单例**的对象，因为只需要创建一次代理对象，CGLIB更合适，

​	而对于**prototype的对象**，由于每次调用都会重新创建一个新的对象，所以JDK动态代理更合适一点。