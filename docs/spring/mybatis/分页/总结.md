后两种方式适合表中有大量数据，一次全部返回给前端太大。





## 第一种方式

以前是前端传limit和page，pagehelper返回给前端所有页的数据



## 第二种方式

pagehelper获取所有数据 + 后端自己算start, end。返回给前端就是那一页的。



## 第三种方式【现在采用】

不用pagehelper，手写sql limit

start, end 都是放在前端算了，只传给后端  limit和start，直接用就行了

```java
// controller
/**
 * 查询房间信息分页
 */
@PostMapping(WebURIMappingConstant.PAGE)
public Rest<JsonPagedVO<RoomInfoVO>> queryRoomInfoPage(@RequestBody @Validated RoomInfoCondition condition) {
    LOGGER.info("用户：{}，查询房间信息分页:{}", getCurrentUserId(), condition);

    return RestBody.okData(roomInfoService.queryRoomInfoPage(condition));
}
```



```java
// service
@Override
public JsonPagedVO<RoomInfoVO> queryRoomInfoPage(RoomInfoCondition condition) {
    LOGGER.info("查询房间信息分页，condition:{}", condition);
    // 查数量
    final long total = roomInfoRepository.queryRoomInfoTotal(condition);
    // 查具体信息
    final List<RoomInfoVO> list = total > 0 ? roomInfoRepository.queryRoomInfoPage(condition) : Collections.emptyList();
    // 模仿Page格式的类
    return new JsonPagedVO<>(list, total);
}


public final class JsonPagedVO<T> {
    private Long total;
    private List<T> rows;
    ...
}
```



```xml
<!--查询房间信息总数-->
<select id="queryRoomInfoTotal" resultType="java.lang.Long">
    SELECT COUNT(*)
    FROM t_room_info
    WHERE deleted_flag = '0'
    <if test="roomName != null and roomName != ''">
        AND room_name LIKE '%'||#{roomName}||'%'
    </if>
</select>

<!--查询房间信息分页-->
<select id="queryRoomInfoPage" resultType="com.safesoft.domain.appointment.equipment.room.vo.RoomInfoVO">
    SELECT id,
           room_name,
           room_description
        FROM t_room_info
    WHERE deleted_flag = '0'
    <if test="roomName != null and roomName != ''">
        AND room_name LIKE '%'||#{roomName}||'%'
    </if>
    ORDER BY created_time DESC
    LIMIT #{limit} OFFSET #{start}
</select>
```

limit和start

```java
package com.safesoft.domains;

// 继承需重写 getStart()
@Date
public abstract class AbstractPaginationQueryCondition extends AbstractBaseCondition {
    // 起始条数
    private Integer start = 0;
    // 每页个数
    private Integer limit = 20;
    // 页数
    private Integer page = 1;

    public AbstractPaginationQueryCondition() {
    }

    public String toString() {
        String var10000 = super.toString();
        return "AbstractPaginationQueryCondition(super=" + var10000 + ", start=" + this.getStart() + ", limit=" + this.getLimit() + ", page=" + this.getPage() + ")";
    }
}
```

```java
package com.safesoft.domain.institution.criteria;

import com.safesoft.domains.AbstractPaginationQueryCondition;
import lombok.Data;

@Data
public class TeacherInfoCriteria extends AbstractPaginationQueryCondition {
    private Long institutionId;

    @Override
    public Integer getStart() {
        final Integer page = getPage();	// 第几页
        final Integer limit = getLimit(); // 每页的条数
        if (page != null && limit != null) {
            return (page - 1) * limit;
        }
        return null;
    }
}

```

