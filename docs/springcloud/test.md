## mq

1. å¸¸é‡ç±»ï¼šäº¤æ¢æœºåã€é˜Ÿåˆ—åã€routingkey
2. configç±»å®šä¹‰beanï¼šäº¤æ¢æœºã€é˜Ÿåˆ—ã€ç»‘å®š
3. Aä¸šåŠ¡çš„controller: æ³¨å…¥rebbitTemplateæ¥å‘é€æ¶ˆæ¯ã€‚
4. Bä¸šåŠ¡çš„listenerç±»


## æ‹¼éŸ³è‡ªåŠ¨è¡¥å…¨
æ‹¼éŸ³æœç´¢
- `settings`è‡ªå®šä¹‰åˆ†è¯å™¨ï¼š`ik_max_word`ï¼Œå…ˆåˆ†è¯ï¼Œå†è¯è½¬æ‹¼éŸ³
- `mappings`å®šä¹‰å­—æ®µï¼šåˆ†æ‹¼éŸ³æœç´¢å’Œä¸­æ–‡æœç´ ï¼Œ`search_analyzer`

è‡ªåŠ¨è¡¥å…¨
- `settings`è‡ªå®šä¹‰åˆ†è¯å™¨ï¼š
- `mappings`å®šä¹‰å­—æ®µï¼šå­—æ®µç±»å‹ `completion`ï¼Œå€¼æ˜¯æ•°ç»„
- è·³è¿‡é‡å¤ã€å‰sizeæ¡




## æ•°æ®åŒæ­¥

æ–¹æ¡ˆï¼šåŒæ­¥è°ƒç”¨ã€å¼‚æ­¥é€šçŸ¥ã€ç›‘å¬binlog


åŒæ­¥è°ƒç”¨ï¼š
- è¿‡ç¨‹ï¼šAä¸šåŠ¡ä¸­ï¼Œå†™å…¥mysqlå’Œè°ƒç”¨Bä¸šåŠ¡æ›´æ–°esï¼›Bä¸šåŠ¡ç»“æŸè¿”å›ï¼ŒAä¸šåŠ¡æ‰ç»“æŸã€‚
- ä¼˜ç‚¹ï¼šå®ç°ç®€å•ã€‚
- ç¼ºç‚¹ï¼šä¸šåŠ¡è€¦åˆï¼Œè€—æ—¶

å¼‚æ­¥é€šçŸ¥ï¼ˆğŸš€ï¼‰ï¼š
- è¿‡ç¨‹ï¼šAå†™å…¥mysqlå¹¶å‘å¸ƒæ¶ˆæ¯ç»™mqï¼Œå°±ç»“æŸï¼›Bç›‘å¬mqæ¥æ›´æ–°esã€‚
- ä¼˜ç‚¹ï¼šè€¦åˆåº¦ä½
- ç¼ºç‚¹ï¼šmqçš„å¯é æ€§

ç›‘å¬binlogï¼š
- è¿‡ç¨‹ï¼šAå†™å…¥mysqlå°±ç»“æŸï¼›canalç›‘å¬binlogï¼Œé€šçŸ¥Bæ¥æ›´æ–°esã€‚
- ä¼˜ç‚¹ï¼šä¸šåŠ¡è€¦åˆæœ€ä½ã€‚
- ç¼ºç‚¹ï¼šmysqlå‹åŠ›å¢å¤§ï¼Œå®ç°å¤æ‚ã€‚

## esé›†ç¾¤

esé›†ç¾¤è§£å†³çš„é—®é¢˜ï¼š
- æµ·é‡æ•°æ®å­˜å‚¨ï¼šåˆ†ç‰‡åˆ°å¤šä¸ªèŠ‚ç‚¹
- å•ç‚¹æ•…éšœï¼šèŠ‚ç‚¹å¤‡ä»½ + é”™ä½å­˜å¤‡ä»½


esé›†ç¾¤èŠ‚ç‚¹çš„è§’è‰²ï¼š
- master eligibleï¼šä¸»èŠ‚ç‚¹ç®¡ç†ï¼ˆé›†æƒã€åˆ†ç‰‡ã€å¢åˆ ç´¢å¼•åº“ï¼‰ã€å®•æœºå€™é€‰ä¸»èŠ‚ç‚¹
- dataï¼šæ•°æ®çš„crud
- ingestï¼šæ•°æ®çš„é¢„å¤„ç†ï¼Œä¸æ€ä¹ˆç”¨
- coordinatingï¼šè·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€åˆå¹¶


- `explain`å‘½ä»¤ï¼šæ˜¾ç¤ºæ•°æ®åœ¨å“ªä¸ªç‰‡`_shard`
- åˆ†ç‰‡ç®—æ³•ï¼šhashï¼ˆæ–‡æ¡£idï¼‰ + å–ä½™ï¼ˆåˆ†ç‰‡æ•°é‡ï¼‰ã€åˆ†ç‰‡æ•°é‡ä¸èƒ½å˜ã€‚


æ–°å¢æ–‡æ¡£æµç¨‹

![alt text](../../images/image-13.png)

æŸ¥è¯¢æµç¨‹ï¼š
- åˆ†æ•£é˜¶æ®µï¼šåè°ƒèŠ‚ç‚¹åˆ†å‘è¯·æ±‚åˆ°å„åˆ†ç‰‡
- èšé›†é˜¶æ®µï¼šåè°ƒèŠ‚ç‚¹æ±‡æ€»åˆ†ç‰‡çš„ç»“æœï¼Œè¿”å›ç»™ç”¨æˆ·

æ•…éšœè½¬ç§»ï¼š
1. å€™é€‰èŠ‚ç‚¹é€‰ä¸»
2. æ•°æ®è¿ç§»ï¼šæ–°ä¸»èŠ‚ç‚¹è¿ç§»å®•æœºèŠ‚ç‚¹æ•°æ®åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚
3. å®•æœºæ¢å¤ï¼šè¿å›æ•°æ®ã€‚

## sentinel

é›ªå´©é—®é¢˜ï¼š
- è¿‡ç¨‹ï¼šç§¯ç´¯é˜¶æ®µï¼šAè°ƒç”¨åçš„Dçš„çº¿ç¨‹æ— é™é˜»å¡ï¼Œåˆ«çš„æœåŠ¡è¿˜èƒ½è®¿é—®ï¼Œä½†éšè®¿é—®Då¢åŠ ï¼Œtomcatèµ„æºè¢«é˜»å¡çº¿ç¨‹å æ»¡ã€‚çº§è”é˜¶æ®µï¼šå‘ä¸Šä¼ é€’ï¼Œè®¿é—®Açš„çº¿ç¨‹é˜»å¡ã€‚
- è§£å†³ï¼šæœåŠ¡æ•…éšœè€Œå¼•èµ·ï¼ˆè¶…æ—¶å¤„ç†ï¼›èˆ±å£æ¨¡å¼ï¼›ç†”æ–­é™çº§ï¼‰ã€é«˜å¹¶å‘æµé‡è€Œå¼•èµ·ï¼ˆæµé‡æ§åˆ¶ï¼‰
  - è¶…æ—¶å¤„ç†ï¼šä¸ä¼šæ— ä¼‘æ­¢ç­‰å¾…ã€‚æ¶Œå…¥é€Ÿåº¦è¿‡å¿«ï¼Œè¿˜æ˜¯ä¼šé›ªå´©
  - èˆ±å£æ¨¡å¼ï¼šçº¿ç¨‹æ± éš”ç¦»ï¼ˆå„ä¸šåŠ¡æœ‰è‡ªå·±çš„çº¿ç¨‹æ± ï¼‰ã€ä¿¡å·é‡éš”ç¦»ï¼ˆå…¬ç”¨çº¿ç¨‹æ± ï¼Œä¿¡å·é‡é™å®šå„ä¸šåŠ¡çš„çº¿ç¨‹æ•°é‡ï¼‰ã€‚ä½†è¿˜æ˜¯æµªè´¹ï¼Œä¸šåŠ¡åäº†è¿˜å°è¯•è®¿é—®ã€‚
  - ç†”æ–­é™çº§ï¼šæ–­è·¯å™¨ã€‚ç»Ÿè®¡è®¿é—®Dçš„å¼‚å¸¸æ¯”ä¾‹ï¼Œè¶…é˜ˆåˆ™ç†”æ–­ä¸šåŠ¡ï¼ˆå¿«é€Ÿå¤±è´¥é‡Šæ”¾èµ„æº+æ‹¦æˆªè¯·æ±‚ï¼‰
  - æµé‡æ§åˆ¶ï¼šé™åˆ¶QPSçš„æµé‡æ¿€å¢ã€‚

sentinelå®ç°äº†åä¸‰ç§ã€‚


æµæ§æ¨¡å¼ï¼šç›´æ¥ã€å…³è”ã€é“¾è·¯ã€‚
- A->C,B->C
- ç›´æ¥ï¼šCï¼Œé‚£ä¹ˆAã€Béƒ½å¯èƒ½å¤±è´¥ã€‚
- å…³è”ï¼šé™æµå½“å‰ã€‚
  - å…³è”Aåˆ°Bä¸Šï¼šå½“Aå¢ä¸šåŠ¡è¶…é˜ˆï¼Œé™æµBæŸ¥è¯¢ã€‚
  - å…³è”Cåˆ°Bä¸Šï¼šå½“Cç”±Aå’ŒBä¸€èµ·è€Œè¶…é˜ˆï¼Œé‚£ä¹ˆBè¢«é™æµï¼ŒAæ— å½±å“ã€‚
- é“¾è·¯ï¼šå…³è”Cåˆ°Bä¸Šçš„é™æµæ”¹è¿›ç‰ˆã€‚åªç»Ÿè®¡Cä¸­B->Cçš„ï¼Œè¶…é˜ˆåˆ™é™æµBï¼ŒAæ— å½±å“ã€‚

æµæ§æ•ˆæœï¼š
- å¿«é€Ÿå¤±è´¥ï¼šQPSè¶…é˜ˆç›´æ¥æ‹’ç»ã€‚
- warm upé¢„çƒ­ï¼šQPSè¶…é˜ˆç›´æ¥æ‹’ç»ï¼›åº”å¯¹ç³»ç»Ÿå†·å¯åŠ¨ï¼ŒQPSé˜ˆå€¼â†‘ã€‚
- æ’é˜Ÿç­‰å¾…ï¼šæµé‡æ•´å½¢ï¼Œè¿›å…¥é˜Ÿåˆ—ã€‚é¢„æœŸç­‰å¾…æ—¶é•¿å¤§äºè¶…æ—¶æ—¶é•¿ï¼Œç›´æ¥æ‹’ç»ã€‚
- çƒ­ç‚¹å‚æ•°é™æµï¼šåˆ†åˆ«ç»Ÿè®¡å‚æ•°å€¼ç›¸åŒçš„è¯·æ±‚ã€‚å¯ä»¥é’ˆå¯¹é«˜è®¿é—®çš„å‚æ•°è®¾ç«‹ç‹¬ç«‹çš„é˜ˆå€¼ã€‚éœ€è¦`@SentinelResource`ã€‚åªæ”¯æŒåŸºæœ¬ç±»å‹å’ŒStringçš„å‚æ•°ã€‚

èˆ±å£æ¨¡å¼å’Œç†”æ–­é™çº§ï¼šfeignæ•´åˆsentinel


èˆ±å£æ¨¡å¼ï¼š
- çº¿ç¨‹æ± éš”ç¦» vs ä¿¡å·é‡éš”ç¦»

  çº¿ç¨‹æ± éš”ç¦»æ˜¯ç‹¬ç«‹çº¿ç¨‹ï¼Œåˆ™æ”¯æŒä¸»åŠ¨è¶…æ—¶ã€å¼‚æ­¥è°ƒç”¨ã€‚ä¿¡å·é‡éš”ç¦»ä¸æ”¯æŒã€‚
  
  çº¿ç¨‹æ± éš”ç¦»çš„ä»£ä»·ï¼šçº¿ç¨‹çš„é¢å¤–å¼€é”€ã€‚ä¿¡å·é‡åˆ™æ²¡æœ‰ã€‚

  åœºæ™¯ï¼šçº¿ç¨‹æ± éš”ç¦»é€‚åˆä½æ‰‡å‡ºï¼ˆä¸éœ€è¦é¢‘ç¹åˆ›å»ºçº¿ç¨‹ï¼‰ã€‚ä¿¡å·é‡éš”ç¦»é€‚åˆé«˜æ‰‡å‡ºã€é«˜é¢‘è°ƒç”¨ï¼Œæ¯”å¦‚ç½‘å…³ã€‚

ç†”æ–­é™çº§ï¼š

![alt text](../../images/image-30.png)

- æ…¢è°ƒç”¨æ¯”ä¾‹ï¼šæ…¢è°ƒç”¨ï¼Œä¸šåŠ¡çš„å“åº”æ—¶é—´RTé•¿ã€‚
- å¼‚å¸¸æ¯”ä¾‹
- å¼‚å¸¸æ•°

æˆæƒè§„åˆ™ï¼šåªæˆæƒæ¥è‡ªç½‘å…³çš„è¯·æ±‚
1. orderæœåŠ¡ä¸­ä¸€ä¸ªComponentç±»å®ç°`RequestOriginParser`æ¥å£
2. gatewayæœåŠ¡ä¸­ï¼Œymlæ–‡ä»¶é…ç½®`AddRequestHeader`å‚æ•°


è‡ªå®šä¹‰å¼‚å¸¸ï¼šæ ¹æ®ä¸åŒå¼‚å¸¸è¿”å›ä¸åŒç»“æœ
- å®ç°`BlockExceptionHander`ã€‚


è§„åˆ™æŒä¹…åŒ–ï¼š
- åŸå§‹æ¨¡å¼ï¼šä¿å­˜åœ¨å†…å­˜ã€‚é‡å¯åˆ™ä¸¢å¤±ã€‚
- pullæ¨¡å¼ï¼šä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ï¼Œå®šæ—¶è¯»å–ã€‚æ—¶æ•ˆæ€§é—®é¢˜ï¼ˆè§„åˆ™è¯»å–ä¸åŠæ—¶ï¼Œè€Œå¯¼è‡´æœåŠ¡æ•°æ®ä¸ä¸€è‡´ï¼‰
- pushæ¨¡å¼ï¼šä¿å­˜åœ¨nacosè¿œç¨‹é…ç½®ä¸­å¿ƒï¼Œsentinelå®¢æˆ·ç«¯ç›‘å¬å˜æ›´ï¼Œå®æ—¶æ›´æ–°ã€‚

## åˆ†å¸ƒå¼äº‹åŠ¡ Seata

ä¸€ä¸ªä¸šåŠ¡æ¶‰åŠå¤šä¸ªåˆ†æ”¯æœåŠ¡ï¼Œæ‰€æœ‰çš„åˆ†æ”¯æœåŠ¡è¦æ•´ä½“å½“æˆä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå…¨å±€äº‹åŠ¡ï¼‰ã€‚

CAPå®šç†ï¼šä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§ã€‚
- åˆ†åŒºé—®é¢˜ä¸å¯é¿å…ï¼ˆèŠ‚ç‚¹ä¹‹é—´ç”¨äºåŒæ­¥æ•°æ®çš„ç½‘ç»œé“¾æ¥æ³¢åŠ¨ï¼‰ï¼Œä¸€è‡´æ€§å’Œå¯ç”¨æ€§å°±æ— æ³•åŒæ—¶æ»¡è¶³ã€‚
- esæ˜¯CPã€‚eså‡ºç°åˆ†åŒºï¼Œå‰”é™¤å®•æœºèŠ‚ç‚¹ï¼Œè¿ç§»æ•°æ®åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚


BASEç†è®ºï¼š
- Bascially AvailableåŸºæœ¬å¯ç”¨ï¼šéƒ¨åˆ†å¯ç”¨
- Soft Stateè½¯çŠ¶æ€ï¼šä¸´æ—¶ä¸ä¸€è‡´
- Eventually Consistentæœ€ç»ˆä¸€è‡´æ€§ï¼šè½¯çŠ¶æ€ç»“æŸåï¼Œæœ€ç»ˆè®©æ•°æ®ä¸€è‡´ã€‚

BASEç†è®ºç”¨äºè§£å†³CAP
- APæ¨¡å¼/æœ€ç»ˆä¸€è‡´æ€æƒ³ï¼šå­äº‹åŠ¡åˆ†åˆ«æäº¤ï¼Œä¸´æ—¶ä¸ä¸€è‡´ï¼Œäº‹åå¼¥è¡¥æ¢å¤æ•°æ®ã€‚
- CPæ¨¡å¼/å¼ºä¸€è‡´æ€æƒ³ï¼šå­äº‹åŠ¡æ‰§è¡Œåäº’ç›¸ç­‰å¾…ï¼ˆå¼±å¯ç”¨ï¼‰ï¼Œéƒ½æˆåŠŸåˆ™åŒæ—¶æäº¤ï¼Œæœ‰å¤±è´¥åˆ™åŒæ—¶å›æ»š

Seataçš„ä¸‰ä¸ªè§’è‰²ï¼šTCäº‹åŠ¡åè°ƒè€…ã€TMäº‹åŠ¡ç®¡ç†å™¨ã€TMèµ„æºç®¡ç†å™¨
1. TMä»£ç†å…¥å£æ–¹æ³•ï¼ˆè°ƒç”¨å…¶ä»–åˆ†æ”¯äº‹åŠ¡ï¼‰ï¼Œç¡®å®šå…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼ˆæ¶‰åŠåˆ°çš„å­äº‹åŠ¡ï¼‰ï¼Œå‘TCæ³¨å†Œã€å¼€å¯å…¨å±€äº‹åŠ¡ã€‚
2. RMä»£ç†åˆ†æ”¯äº‹åŠ¡ï¼Œå‘TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡ã€æ‰§è¡Œsqlã€æŠ¥å‘Šæ‰§è¡ŒçŠ¶æ€ã€‚
3. æ‰€æœ‰äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ŒTMå‘ŠçŸ¥TCæ£€æŸ¥åˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼ŒTCé€šçŸ¥RMæäº¤å­äº‹åŠ¡æˆ–å›æ»šã€‚


Seataçš„å››ç§æ–¹æ¡ˆï¼š
- XAï¼š
  
  å¼ºä¸€è‡´ã€åˆ†é˜¶æ®µï¼Œæ— ä¸šåŠ¡ä¾µå…¥ã€‚

  å¸¸ç”¨æ•°æ®åº“å·²æ”¯æŒXAï¼Œå®ç°ç®€å•ã€‚æ•°æ®åº“ä¸æ”¯æŒåˆ™ä¸è¡Œã€‚å ç”¨æ•°æ®åº“é”ï¼ˆæ‰§è¡Œsqlä¸Šé”ã€TCé€šçŸ¥åé‡Šæ”¾ï¼‰ï¼Œæ€§èƒ½ä½ã€‚
- TCC

  æœ€ç»ˆä¸€è‡´ã€åˆ†é˜¶æ®µï¼Œæœ‰ä¸šåŠ¡ä¾µå…¥ã€‚
- ATï¼ˆé»˜è®¤ï¼‰

  æœ€ç»ˆä¸€è‡´ã€åˆ†é˜¶æ®µï¼Œæ— ä¸šåŠ¡ä¾µå…¥ã€‚

  ä¸€é˜¶æ®µï¼ŒRMè®°å½•æ•°æ®å¿«ç…§undo logï¼Œæ‰§è¡Œsqlå°±ç›´æ¥æäº¤ã€‚äºŒé˜¶æ®µï¼ŒæˆåŠŸåˆ™åˆ é™¤å¿«ç…§ï¼Œå¤±è´¥åˆ™æ ¹æ®å¿«ç…§æ¢å¤ã€‚

  é˜¶æ®µä¸€äºŒä¹‹é—´æ— é”ï¼Œäº‹åŠ¡å¹¶å‘çš„è„å†™é—®é¢˜ğŸ‘‰å…¨å±€é”ï¼Œä½†éseataç®¡ç†çš„å…¨å±€äº‹åŠ¡å¯ä¿®æ”¹ğŸ‘‰ä¿å­˜ä¸¤ä¸ªå¿«ç…§ï¼Œæ›´æ–°å‰åafter-iamgeï¼Œbefore-image

- SAGA

  é•¿ä¸šåŠ¡ï¼Œæœ‰ä¸šåŠ¡ä¾µå…¥ã€‚

XA vs AT
- XAæ¨¡å¼å¼ºä¸€è‡´; ATæ¨¡å¼æœ€ç»ˆä¸€è‡´
- é”ï¼šXAæ¨¡å¼ä¸€é˜¶æ®µä¸æäº¤äº‹åŠ¡ï¼Œé”å®šèµ„æº; ATæ¨¡å¼ä¸€é˜¶æ®µç›´æ¥æäº¤ï¼Œä¸é”å®šèµ„æºã€‚
- å›æ»šæ¨¡å¼ï¼šXAæ¨¡å¼ ä¾èµ–æ•°æ®åº“æœºåˆ¶å®ç°å›æ»š; ATæ¨¡å¼åˆ©ç”¨æ•°æ®å¿«ç…§å®ç°æ•°æ®å›æ»šã€‚


TCæœåŠ¡å™¨æ­å»º tc-server
- registryæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆå…¶ä»–åˆ†æ”¯äº‹åŠ¡ï¼‰ï¼ŒconfigæœåŠ¡é…ç½®ä¸­å¿ƒï¼ˆseataçš„configï¼Œæœ‰å¤šä¸ªseataï¼‰

## ä¸šåŠ¡

> ä¸šåŠ¡ï¼šæ‹¼éŸ³è‡ªåŠ¨

è‡ªåŠ¨è¡¥å…¨`suggestion`å­—æ®µï¼Œå€¼å¤ç”¨ï¼ˆå€¼åœ¨æ„é€ å‡½æ•°èµ‹å€¼å…¶ä»–å­—æ®µï¼‰ã€å¤ç”¨åˆ‡å‰²ï¼ˆ`A/B`ï¼‰ã€‚

> esåŒæ­¥

adminæ¨¡å—ä¿®æ”¹mysqlï¼ŒåŒæ­¥demoæ¨¡å—çš„esï¼Œdemoå±•ç¤ºç»™å‰æ®µã€‚
- ä¿®æ”¹mysqlåªéœ€ä¸¤ä¸ªæ–¹æ³•ï¼šå¢æ”¹ä¸€æ ·ã€åˆ 
    
    ä¸ºä»€ä¹ˆå¢æ”¹ä¸€æ ·ï¼Ÿ esçš„å¢æ”¹æ“ä½œä¸€æ · + æ‹¿ç€idå»mysqlæ‰¾æ–°çš„æ•°æ®ã€‚

> ä¸šåŠ¡éš”ç¦»

feignè¿œç¨‹è°ƒç”¨ã€clientï¼Ÿ
----


